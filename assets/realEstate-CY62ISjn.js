import{j as h,r as D,N as c,O as I,P as n,Q as p,S as u,T as P,U as m,V as y,W as _}from"./index-CgwtBPp_.js";import{g as i}from"./generateUniqueId-BGfF6MB9.js";import{g as l}from"./getDocumentsByFilters-2V0AzAdK.js";const W=h("realEstate",()=>{const g=D(null);return{createDocument:async a=>{const s=a;s.documentation=await Promise.all(s.documentation.map(async t=>(t&&(t!=null&&t.file)&&(t=await c(t==null?void 0:t.file,`real_estate_documentation/${i()}`)),t))),s.pictures=await Promise.all(s.pictures.map(async t=>(t&&(t!=null&&t.file)&&(t=await c(t==null?void 0:t.file,`real_estate_pictures/${i()}`)),t)));try{const t=await I(n,s);return await p(t,{id:t.id}),{status:1}}catch(t){return console.log(t),{status:0}}},getItemsByFilters:async(a=1,s)=>{try{const{documents:t,totalPages:r}=await l(n,g,a,s);return{documents:await Promise.all(t.map(async e=>{try{if(!e.userId)throw new Error("User ID is missing");const d=u(P,"customers",e.userId),f=await m(d),w=f.exists()?f.data():null;return{...e,user:w}}catch(d){return console.error("Error fetching user data for document: ",e.id,d),{...e,user:null}}})),totalPages:r}}catch(t){return console.error("Error fetching documents: ",t),{documents:[],totalPages:0}}},deleteDocument:async a=>{try{const s=u(n,a),t=await m(s);if(t.exists()){const r=t.data();for(const o of r.pictures)o&&await y(o);for(const o of r.documentation)o&&await y(o)}return await _(s),{status:1}}catch(s){return console.error("Error deleting document: ",s),{status:0}}},getDocumentById:async a=>{try{const s=u(n,a),t=await m(s);return t.exists()?{status:1,document:{...t.data()}}:{status:0,document:null}}catch(s){return console.error("Error fetching document: ",s),{status:0,document:null}}},updateDocument:async(a,s)=>{const t=a;t.documentation=await Promise.all(t.documentation.map(async r=>(r&&(r!=null&&r.file)&&(r=await c(r==null?void 0:r.file,`real_estate_documentation/${i()}`)),r))),t.pictures=await Promise.all(t.pictures.map(async r=>(r&&(r!=null&&r.file)&&(r=await c(r==null?void 0:r.file,`real_estate_pictures/${i()}`)),r)));try{const r=u(n,s);return await p(r,{...t}),{status:1}}catch(r){return console.log("Error updating document:",r),{status:0}}}}});export{W as u};
